# Hybrid Bot Engine

–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –±–æ—Ç–∞ –¥–ª—è Telegram –∏ Web –ø–ª–∞—Ç—Ñ–æ—Ä–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Supabase.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å**: Telegram + Web –≤ –µ–¥–∏–Ω–æ–º —è–¥—Ä–µ
- **Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, –º–∞–≥–∞–∑–∏–Ω—ã
- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ AI**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GPT/LangChain
- **Fallback –ª–æ–≥–∏–∫–∞**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/bot
  ‚îú‚îÄ‚îÄ webhook.ts                # –ï–¥–∏–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
  ‚îú‚îÄ‚îÄ adapters/
  ‚îÇ     ‚îú‚îÄ‚îÄ telegramAdapter.ts  # Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
  ‚îÇ     ‚îî‚îÄ‚îÄ webAdapter.ts       # Web –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
  ‚îú‚îÄ‚îÄ core/
  ‚îÇ     ‚îú‚îÄ‚îÄ botEngine.ts        # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
  ‚îÇ     ‚îú‚îÄ‚îÄ userSession.ts      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
  ‚îÇ     ‚îî‚îÄ‚îÄ actions.ts          # –î–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞
/lib
  ‚îî‚îÄ‚îÄ supabaseClient.ts         # Supabase –∫–ª–∏–µ–Ω—Ç
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
```bash
git clone https://github.com/teleplatform/hybrid-bot-engine.git
cd hybrid-bot-engine
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
npm install
```

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
cp env.example .env.local
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env.local`:
```env
SUPABASE_URL=https://qjzbzsvwxrecugafblnd.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
```

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase**

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ Supabase SQL Editor:

```sql
-- users table
create table users (
  id text primary key,
  telegram_id text,
  web_id text,
  email text,
  name text,
  last_seen timestamp default now()
);

-- messages table
create table messages (
  id bigint generated by default as identity primary key,
  user_id text references users(id),
  role text check (role in ('user','bot')),
  text text,
  timestamp timestamp default now()
);

-- stores table
create table stores (
  id bigint generated by default as identity primary key,
  owner_id text references users(id),
  name text,
  created_at timestamp default now()
);
```

5. **–ó–∞–ø—É—Å–∫**
```bash
npm run dev
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Telegram Webhook

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Telegram Bot API:
```
https://your-domain.com/api/bot/webhook
```

### Web API

–û—Ç–ø—Ä–∞–≤—å—Ç–µ POST –∑–∞–ø—Ä–æ—Å:
```bash
curl -X POST http://localhost:3000/api/bot/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "web",
    "payload": {
      "userId": "testuser123",
      "message": "–ü—Ä–∏–≤–µ—Ç, —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω"
    }
  }'
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- **–°–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω**: "–º–∞–≥–∞–∑–∏–Ω", "store"
- **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ**: "–ø—Ä–∏–≤–µ—Ç", "hello"
- **–ü–æ–º–æ—â—å**: "–ø–æ–º–æ—â—å", "help"
- **–ò—Å—Ç–æ—Ä–∏—è**: "–∏—Å—Ç–æ—Ä–∏—è", "history"

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç Web –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

```bash
curl -X POST http://localhost:3000/api/bot/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "web",
    "payload": {
      "userId": "testuser123",
      "message": "–ü—Ä–∏–≤–µ—Ç"
    }
  }'
```

### –¢–µ—Å—Ç Telegram (—Å–∏–º—É–ª—è—Ü–∏—è)

```bash
curl -X POST http://localhost:3000/api/bot/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "telegram",
    "payload": {
      "message": {
        "text": "–ü—Ä–∏–≤–µ—Ç"
      },
      "from": {
        "id": 123456789
      }
    }
  }'
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase:

1. **users** - —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
2. **messages** - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
3. **stores** - —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ OpenAI/LangChain
2. **Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: React —á–∞—Ç –Ω–∞ —Å–∞–π—Ç–µ
3. **Fallback –ª–æ–≥–∏–∫–∞**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: Docker, Kubernetes

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- RLS –≤ Supabase

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –í–∫–ª–∞–¥

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. Push –≤ branch
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- GitHub Issues
- Email: v.taitoo@bk.ru
- Telegram: @Vijayee83 